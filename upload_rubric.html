<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Upload Grading Rubric - ProfAI</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav>
    <h2>ProfAI</h2>
    <ul>
      <li><a href="prof_dashboard.html">Dashboard</a></li>
      <li><a href="upload_rubric.html" class="active">Upload Rubric</a></li>
      <li>
        <select id="classSelect">
          <option value="">Select Class</option>
          <option value="CS101">CS101</option>
          <option value="ENG201">ENG201</option>
        </select>
      </li>
    </ul>
    <div style="float:right; margin-right:30px;">
      <span>User: xxxxxxxxxx</span>
      <a href="#" class="logout" style="margin-left:12px;">Logout &#8635;</a>
    </div>
  </nav>

  <main class="add-assignment-container">
    <h3>Upload Grading Rubric</h3>
    <form id="rubricForm" enctype="multipart/form-data">
      <label for="rubricTitle">Rubric Title:</label>
      <input type="text" id="rubricTitle" name="rubricTitle" required />

      <label for="rubricFile">Upload Rubric File:</label>
      <input type="file" id="rubricFile" name="rubricFile" accept=".pdf,.doc,.docx,.xlsx,.csv" required />

      <label for="rubricDesc">Rubric Description (optional):</label>
      <textarea id="rubricDesc" name="rubricDesc" rows="3"></textarea>

      <button type="submit">Upload Rubric</button>
    </form>
    <div id="rubricMsg"></div>
  </main>

  <script>
    document.getElementById('classSelect').addEventListener('change', function() {
      if (this.value) {
        alert('Switched to class: ' + this.value);
      }
    });

    document.getElementById('rubricForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      // Simulate upload
      const form = e.target;
    const formData = new FormData(form);  // grabs all inputs including file

    // Optionally append class info if needed by backend:
    const classSelect = document.getElementById('classSelect');
    if (classSelect.value) {
      formData.append('class', classSelect.value);
    }

    // Clear previous messages and show loading
    const msgDiv = document.getElementById('rubricMsg');
    msgDiv.textContent = 'Uploading rubric...';

    try {
      const response = await fetch('/api/upload/reference', {
        method: 'POST',
        body: formData
      });

      const data = await response.json();

      if (response.ok) {
        msgDiv.textContent = data.message || 'Rubric uploaded successfully!';
        form.reset();
      } else {
        msgDiv.textContent = data.error || 'Failed to upload rubric.';
      }
    } catch (error) {
      console.error('Upload error:', error);
      msgDiv.textContent = 'Error uploading rubric. Please try again.';
    }
  });
</script>
</body>
</html>
